{% extends "base.html" %}

{% block title %}XML Editor - {{ persona.name }} - MiaChat{% endblock %}

{% block extra_css %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css" rel="stylesheet">
<style>
    .CodeMirror {
        height: 500px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    .trait-card {
        margin-bottom: 1rem;
    }
    .trait-value {
        font-size: 1.2rem;
        font-weight: bold;
    }
    .trait-slider {
        width: 100%;
    }
    .model-config {
        background-color: #f8f9fa;
        padding: 1rem;
        border-radius: 4px;
        margin-bottom: 1rem;
    }
    .section-card {
        margin-bottom: 1.5rem;
    }
    .enneagram-type {
        font-size: 1.2rem;
        font-weight: bold;
        color: #0d6efd;
    }
    .pitfall-item {
        padding: 0.5rem;
        margin-bottom: 0.5rem;
        border-left: 3px solid #dc3545;
        background-color: #f8f9fa;
    }
    .adaptation-item {
        padding: 0.5rem;
        margin-bottom: 0.5rem;
        border-left: 3px solid #198754;
        background-color: #f8f9fa;
    }
    .mode-switcher {
        margin-bottom: 1rem;
    }
    .easy-mode-section {
        background-color: #f8f9fa;
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
    }
    .persona-preview {
        background-color: white;
        padding: 1rem;
        border-radius: 4px;
        margin-top: 1rem;
        border: 1px solid #dee2e6;
    }
    .persona-preview h6 {
        color: #6c757d;
        margin-bottom: 0.5rem;
    }
    .persona-preview p {
        margin-bottom: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Mode Switcher -->
    <div class="mode-switcher">
        <div class="btn-group" role="group">
            <input type="radio" class="btn-check" name="mode" id="easyMode" autocomplete="off" checked>
            <label class="btn btn-outline-primary" for="easyMode">Easy Mode</label>
            
            <input type="radio" class="btn-check" name="mode" id="advancedMode" autocomplete="off">
            <label class="btn btn-outline-primary" for="advancedMode">Advanced Mode</label>
        </div>
    </div>

    <div class="row">
        <!-- Easy Mode Interface -->
        <div id="easyModeInterface" class="col-12">
            <div class="easy-mode-section">
                <h4>Basic Persona Settings</h4>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Persona Type</label>
                            <select class="form-select" id="personaType" onchange="updateEasyMode()">
                                <option value="friendly">Friendly and Supportive</option>
                                <option value="professional">Professional and Direct</option>
                                <option value="creative">Creative and Enthusiastic</option>
                                <option value="analytical">Analytical and Precise</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Communication Style</label>
                            <select class="form-select" id="easyCommunicationStyle" onchange="updateEasyMode()">
                                <option value="casual">Casual and Relaxed</option>
                                <option value="formal">Formal and Professional</option>
                                <option value="balanced">Balanced and Adaptable</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Response Length</label>
                            <select class="form-select" id="responseLength" onchange="updateEasyMode()">
                                <option value="concise">Concise</option>
                                <option value="moderate">Moderate</option>
                                <option value="detailed">Detailed</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="persona-preview">
                            <h6>Persona Preview</h6>
                            <p id="previewDescription">A friendly and supportive AI assistant that communicates in a casual, relaxed manner with concise responses.</p>
                            <h6>Key Traits</h6>
                            <ul id="previewTraits">
                                <li>Friendly and approachable</li>
                                <li>Supportive and encouraging</li>
                                <li>Clear and concise communication</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="easy-mode-section">
                <h4>Persona Traits</h4>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Openness to Experience</label>
                            <input type="range" class="form-range" id="openness" 
                                   min="0" max="100" value="50"
                                   onchange="updateEasyMode()">
                            <div class="d-flex justify-content-between">
                                <small>Traditional</small>
                                <small>Innovative</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Conscientiousness</label>
                            <input type="range" class="form-range" id="conscientiousness" 
                                   min="0" max="100" value="50"
                                   onchange="updateEasyMode()">
                            <div class="d-flex justify-content-between">
                                <small>Flexible</small>
                                <small>Organized</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Extraversion</label>
                            <input type="range" class="form-range" id="extraversion" 
                                   min="0" max="100" value="50"
                                   onchange="updateEasyMode()">
                            <div class="d-flex justify-content-between">
                                <small>Reserved</small>
                                <small>Outgoing</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Agreeableness</label>
                            <input type="range" class="form-range" id="agreeableness" 
                                   min="0" max="100" value="50"
                                   onchange="updateEasyMode()">
                            <div class="d-flex justify-content-between">
                                <small>Direct</small>
                                <small>Supportive</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Emotional Stability</label>
                            <input type="range" class="form-range" id="emotionalStability" 
                                   min="0" max="100" value="50"
                                   onchange="updateEasyMode()">
                            <div class="d-flex justify-content-between">
                                <small>Adaptable</small>
                                <small>Consistent</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="alert alert-info">
                            <h6>About Persona Traits</h6>
                            <p class="mb-0">These traits are based on the Big Five persona model, which is widely used in psychology research. Adjusting these traits will affect how the AI assistant communicates and responds to different situations.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="easy-mode-section">
                <h4>Advanced Settings (Optional)</h4>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">AI Model</label>
                            <select class="form-select" id="easyModelSelect" onchange="updateEasyMode()">
                                <option value="gpt-4">GPT-4 (Most Capable)</option>
                                <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Faster)</option>
                                <option value="claude-3-opus">Claude 3 Opus (Most Creative)</option>
                                <option value="claude-3-sonnet">Claude 3 Sonnet (Balanced)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Creativity Level</label>
                            <input type="range" class="form-range" id="easyCreativity" 
                                   min="0" max="100" value="50"
                                   onchange="updateEasyMode()">
                            <div class="d-flex justify-content-between">
                                <small>More Predictable</small>
                                <small>More Creative</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="alert alert-info">
                            <h6>About Advanced Settings</h6>
                            <p class="mb-0">These settings affect how the AI generates responses. Higher creativity means more unique and varied responses, while lower creativity means more consistent and predictable responses.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Mode Interface -->
        <div id="advancedModeInterface" class="col-12" style="display: none;">
            <div class="row">
                <!-- XML Editor -->
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">XML Configuration</h5>
                            <div>
                                <button class="btn btn-primary" onclick="saveXml()">Save Changes</button>
                                <button class="btn btn-secondary" onclick="validateXml()">Validate</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <textarea id="xmlEditor">{{ persona.xml_config }}</textarea>
                        </div>
                    </div>
                </div>

                <!-- Persona Configuration -->
                <div class="col-md-4">
                    <!-- Core Traits -->
                    <div class="card section-card">
                        <div class="card-header">
                            <h5 class="mb-0">Core Traits</h5>
                        </div>
                        <div class="card-body">
                            {% for trait_name, trait in persona.core_traits.items() %}
                            <div class="trait-card">
                                <h6>{{ trait_name|title }}</h6>
                                <div class="trait-value">{{ (trait.value * 100)|round }}%</div>
                                <input type="range" class="trait-slider" 
                                       min="0" max="100" value="{{ (trait.value * 100)|round }}"
                                       onchange="updateCoreTrait('{{ trait_name }}', this.value)">
                                <small class="text-muted">{{ trait.description }}</small>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Communication Style -->
                    <div class="card section-card">
                        <div class="card-header">
                            <h5 class="mb-0">Communication Style</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Primary Style</label>
                                <select class="form-select" id="primaryStyle" onchange="updateCommunicationStyle()">
                                    <option value="direct">Direct and Action-oriented</option>
                                    <option value="dynamic">Dynamic and Enthusiastic</option>
                                    <option value="supportive">Supportive and Collaborative</option>
                                    <option value="precise">Precise and Detail-oriented</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Secondary Style</label>
                                <select class="form-select" id="secondaryStyle" onchange="updateCommunicationStyle()">
                                    <option value="">None</option>
                                    <option value="direct">Direct and Action-oriented</option>
                                    <option value="dynamic">Dynamic and Enthusiastic</option>
                                    <option value="supportive">Supportive and Collaborative</option>
                                    <option value="precise">Precise and Detail-oriented</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Interaction Style -->
                    <div class="card section-card">
                        <div class="card-header">
                            <h5 class="mb-0">Interaction Style</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Pace</label>
                                <select class="form-select" id="interactionPace" onchange="updateInteractionStyle()">
                                    <option value="fast">Fast and Efficient</option>
                                    <option value="moderate">Moderate and Balanced</option>
                                    <option value="slow">Slow and Thorough</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Formality</label>
                                <select class="form-select" id="interactionFormality" onchange="updateInteractionStyle()">
                                    <option value="casual">Casual and Relaxed</option>
                                    <option value="moderate">Moderate and Balanced</option>
                                    <option value="formal">Formal and Professional</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Decision Making</label>
                                <select class="form-select" id="decisionMaking" onchange="updateInteractionStyle()">
                                    <option value="structured">Structured and Methodical</option>
                                    <option value="balanced">Balanced and Considerate</option>
                                    <option value="flexible">Flexible and Adaptive</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Communication Preferences -->
                    <div class="card section-card">
                        <div class="card-header">
                            <h5 class="mb-0">Communication Preferences</h5>
                        </div>
                        <div class="card-body">
                            <h6>Potential Challenges</h6>
                            <div id="pitfallsList">
                                {% for pitfall in persona.communication_pitfalls.pitfalls %}
                                <div class="pitfall-item">
                                    <div class="input-group">
                                        <input type="text" class="form-control" value="{{ pitfall }}" onchange="updatePitfalls()">
                                        <button class="btn btn-outline-danger" onclick="removePitfall(this)">×</button>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            <button class="btn btn-outline-primary btn-sm mb-3" onclick="addPitfall()">Add Challenge</button>

                            <h6>Adaptation Strategies</h6>
                            <div id="adaptationsList">
                                {% for adapt in persona.communication_pitfalls.adaptation_required %}
                                <div class="adaptation-item">
                                    <div class="input-group">
                                        <input type="text" class="form-control" value="{{ adapt }}" onchange="updatePitfalls()">
                                        <button class="btn btn-outline-danger" onclick="removeAdaptation(this)">×</button>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            <button class="btn btn-outline-primary btn-sm" onclick="addAdaptation()">Add Strategy</button>
                        </div>
                    </div>

                    <!-- Model Configuration -->
                    <div class="card section-card">
                        <div class="card-header">
                            <h5 class="mb-0">Model Configuration</h5>
                        </div>
                        <div class="card-body">
                            <div class="model-config">
                                <div class="mb-3">
                                    <label class="form-label">Model</label>
                                    <select class="form-select" id="modelSelect" onchange="updateModelConfig()">
                                        <option value="gpt-4" {% if persona.model_config.model_name == 'gpt-4' %}selected{% endif %}>GPT-4</option>
                                        <option value="gpt-3.5-turbo" {% if persona.model_config.model_name == 'gpt-3.5-turbo' %}selected{% endif %}>GPT-3.5 Turbo</option>
                                        <option value="claude-3-opus" {% if persona.model_config.model_name == 'claude-3-opus' %}selected{% endif %}>Claude 3 Opus</option>
                                        <option value="claude-3-sonnet" {% if persona.model_config.model_name == 'claude-3-sonnet' %}selected{% endif %}>Claude 3 Sonnet</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Temperature</label>
                                    <input type="range" class="form-range" id="temperature" 
                                           min="0" max="200" value="{{ (persona.model_config.temperature * 100)|round }}"
                                           onchange="updateModelConfig()">
                                    <div class="text-muted text-end">{{ persona.model_config.temperature }}</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Max Tokens</label>
                                    <input type="number" class="form-control" id="maxTokens" 
                                           value="{{ persona.model_config.max_tokens }}"
                                           onchange="updateModelConfig()">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
<script>
    // Initialize CodeMirror
    var editor = CodeMirror.fromTextArea(document.getElementById("xmlEditor"), {
        mode: "xml",
        theme: "monokai",
        lineNumbers: true,
        matchBrackets: true,
        indentUnit: 4,
        lineWrapping: true
    });

    // Mode switching
    document.getElementById('easyMode').addEventListener('change', function() {
        document.getElementById('easyModeInterface').style.display = 'block';
        document.getElementById('advancedModeInterface').style.display = 'none';
    });

    document.getElementById('advancedMode').addEventListener('change', function() {
        document.getElementById('easyModeInterface').style.display = 'none';
        document.getElementById('advancedModeInterface').style.display = 'block';
    });

    // Easy mode persona presets
    const personaPresets = {
        friendly: {
            description: "A friendly and supportive AI assistant that communicates in a casual, relaxed manner with concise responses.",
            traits: [
                "Friendly and approachable",
                "Supportive and encouraging",
                "Clear and concise communication"
            ],
            core_traits: {
                "openness": 0.7,
                "conscientiousness": 0.6,
                "extraversion": 0.8,
                "agreeableness": 0.9,
                "emotional_stability": 0.8
            },
            communication_style: {
                "primary": "supportive",
                "secondary": "dynamic"
            }
        },
        professional: {
            description: "A professional and direct AI assistant that communicates clearly and efficiently with a focus on results.",
            traits: [
                "Professional and efficient",
                "Clear and direct communication",
                "Results-oriented approach"
            ],
            core_traits: {
                "openness": 0.6,
                "conscientiousness": 0.9,
                "extraversion": 0.5,
                "agreeableness": 0.7,
                "emotional_stability": 0.9
            },
            communication_style: {
                "primary": "direct",
                "secondary": "precise"
            }
        },
        creative: {
            description: "A creative and enthusiastic AI assistant that brings energy and innovation to conversations.",
            traits: [
                "Creative and innovative",
                "Enthusiastic and engaging",
                "Adaptable and flexible"
            ],
            core_traits: {
                "openness": 0.9,
                "conscientiousness": 0.6,
                "extraversion": 0.8,
                "agreeableness": 0.7,
                "emotional_stability": 0.7
            },
            communication_style: {
                "primary": "dynamic",
                "secondary": "supportive"
            }
        },
        analytical: {
            description: "An analytical and precise AI assistant that focuses on accuracy and thoroughness in communication.",
            traits: [
                "Analytical and precise",
                "Thorough and detailed",
                "Logical and systematic"
            ],
            core_traits: {
                "openness": 0.7,
                "conscientiousness": 0.9,
                "extraversion": 0.4,
                "agreeableness": 0.6,
                "emotional_stability": 0.8
            },
            communication_style: {
                "primary": "precise",
                "secondary": "direct"
            }
        }
    };

    // Update easy mode settings
    function updateEasyMode() {
        const personaType = document.getElementById('personaType').value;
        const preset = personaPresets[personaType];
        
        // Update preview
        document.getElementById('previewDescription').textContent = preset.description;
        const traitsList = document.getElementById('previewTraits');
        traitsList.innerHTML = preset.traits.map(trait => `<li>${trait}</li>`).join('');

        // Update trait sliders
        document.getElementById('openness').value = preset.core_traits.openness * 100;
        document.getElementById('conscientiousness').value = preset.core_traits.conscientiousness * 100;
        document.getElementById('extraversion').value = preset.core_traits.extraversion * 100;
        document.getElementById('agreeableness').value = preset.core_traits.agreeableness * 100;
        document.getElementById('emotionalStability').value = preset.core_traits.emotional_stability * 100;

        // Update XML
        const xmlDoc = new DOMParser().parseFromString(editor.getValue(), "text/xml");
        
        // Update core traits
        const coreTraits = xmlDoc.querySelector("core_traits");
        if (coreTraits) {
            for (const [trait, value] of Object.entries(preset.core_traits)) {
                const traitElement = coreTraits.querySelector(trait);
                if (traitElement) {
                    traitElement.setAttribute("value", value);
                }
            }
        }

        // Update communication style
        const commStyle = xmlDoc.querySelector("communication_style");
        if (commStyle) {
            commStyle.setAttribute("primary", preset.communication_style.primary);
            commStyle.setAttribute("secondary", preset.communication_style.secondary);
        }

        // Update model settings
        const model = xmlDoc.querySelector("model");
        if (model) {
            model.setAttribute("name", document.getElementById('easyModelSelect').value);
            const creativity = document.getElementById('easyCreativity').value / 100;
            model.setAttribute("temperature", creativity);
        }

        editor.setValue(new XMLSerializer().serializeToString(xmlDoc));
    }

    // Update core trait value in XML
    function updateCoreTrait(name, value) {
        const xmlDoc = new DOMParser().parseFromString(editor.getValue(), "text/xml");
        const trait = xmlDoc.querySelector(`core_traits ${name}`);
        if (trait) {
            trait.setAttribute("value", value / 100);
            editor.setValue(new XMLSerializer().serializeToString(xmlDoc));
        }
    }

    // Update communication style in XML
    function updateCommunicationStyle() {
        const xmlDoc = new DOMParser().parseFromString(editor.getValue(), "text/xml");
        const commStyle = xmlDoc.querySelector("communication_style");
        if (commStyle) {
            commStyle.setAttribute("primary", document.getElementById("primaryStyle").value);
            const secondary = document.getElementById("secondaryStyle").value;
            if (secondary) {
                commStyle.setAttribute("secondary", secondary);
            } else {
                commStyle.removeAttribute("secondary");
            }
            editor.setValue(new XMLSerializer().serializeToString(xmlDoc));
        }
    }

    // Update interaction style in XML
    function updateInteractionStyle() {
        const xmlDoc = new DOMParser().parseFromString(editor.getValue(), "text/xml");
        const interaction = xmlDoc.querySelector("interaction_style");
        if (interaction) {
            interaction.setAttribute("pace", document.getElementById("interactionPace").value);
            interaction.setAttribute("formality", document.getElementById("interactionFormality").value);
            interaction.setAttribute("decision_making", document.getElementById("decisionMaking").value);
            editor.setValue(new XMLSerializer().serializeToString(xmlDoc));
        }
    }

    // Update communication pitfalls in XML
    function updatePitfalls() {
        const xmlDoc = new DOMParser().parseFromString(editor.getValue(), "text/xml");
        const pitfalls = xmlDoc.querySelector("communication_pitfalls");
        if (pitfalls) {
            const pitfallsList = pitfalls.querySelector("pitfalls");
            if (pitfallsList) {
                pitfallsList.innerHTML = "";
                document.querySelectorAll("#pitfallsList input").forEach(input => {
                    const pitfall = document.createElement("pitfall");
                    pitfall.textContent = input.value;
                    pitfallsList.appendChild(pitfall);
                });
            }
            
            const adaptations = pitfalls.querySelector("adaptation_required");
            if (adaptations) {
                adaptations.innerHTML = "";
                document.querySelectorAll("#adaptationsList input").forEach(input => {
                    const adapt = document.createElement("adapt");
                    adapt.textContent = input.value;
                    adaptations.appendChild(adapt);
                });
            }
            
            editor.setValue(new XMLSerializer().serializeToString(xmlDoc));
        }
    }

    // Add/remove pitfall
    function addPitfall() {
        const div = document.createElement("div");
        div.className = "pitfall-item";
        div.innerHTML = `
            <div class="input-group">
                <input type="text" class="form-control" onchange="updatePitfalls()">
                <button class="btn btn-outline-danger" onclick="removePitfall(this)">×</button>
            </div>
        `;
        document.getElementById("pitfallsList").appendChild(div);
    }

    function removePitfall(button) {
        button.closest(".pitfall-item").remove();
        updatePitfalls();
    }

    // Add/remove adaptation
    function addAdaptation() {
        const div = document.createElement("div");
        div.className = "adaptation-item";
        div.innerHTML = `
            <div class="input-group">
                <input type="text" class="form-control" onchange="updatePitfalls()">
                <button class="btn btn-outline-danger" onclick="removeAdaptation(this)">×</button>
            </div>
        `;
        document.getElementById("adaptationsList").appendChild(div);
    }

    function removeAdaptation(button) {
        button.closest(".adaptation-item").remove();
        updatePitfalls();
    }

    // Update model configuration in XML
    function updateModelConfig() {
        const xmlDoc = new DOMParser().parseFromString(editor.getValue(), "text/xml");
        const model = xmlDoc.querySelector("model");
        if (model) {
            model.setAttribute("name", document.getElementById("modelSelect").value);
            model.setAttribute("temperature", document.getElementById("temperature").value / 100);
            model.setAttribute("max_tokens", document.getElementById("maxTokens").value);
            editor.setValue(new XMLSerializer().serializeToString(xmlDoc));
        }
    }

    // Save XML changes
    async function saveXml() {
        try {
            const response = await fetch(`/api/persona/{{ persona.id }}/xml`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    xml_config: editor.getValue()
                })
            });
            
            if (response.ok) {
                showAlert('success', 'XML configuration saved successfully!');
            } else {
                const error = await response.json();
                showAlert('danger', `Error: ${error.detail}`);
            }
        } catch (error) {
            showAlert('danger', `Error: ${error.message}`);
        }
    }

    // Validate XML
    async function validateXml() {
        try {
            const response = await fetch('/api/persona/validate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    xml_config: editor.getValue()
                })
            });
            
            if (response.ok) {
                showAlert('success', 'XML configuration is valid!');
            } else {
                const error = await response.json();
                showAlert('danger', `Invalid XML: ${error.detail}`);
            }
        } catch (error) {
            showAlert('danger', `Error: ${error.message}`);
        }
    }

    // Show alert message
    function showAlert(type, message) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
        alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        document.querySelector('.container-fluid').insertBefore(alertDiv, document.querySelector('.row'));
        setTimeout(() => alertDiv.remove(), 5000);
    }

    // Initialize easy mode
    updateEasyMode();
</script>
{% endblock %} 